from flask import Flask, send_file, render_template_string
import qrcode
import socket
import os

app = Flask(__name__)

HTML = """
<!DOCTYPE html>
<html>
<head>
    <title>F-VIRUS QR VIEW</title>
</head>
<body style="text-align:center; font-family:Arial">
    <h2>F-VIRUS QR SCREEN VIEW</h2>
    <p>Scan QR Code below</p>
    <img src="/qr" width="300">
    <p>Waiting for connection...</p>
</body>
</html>
"""

def get_ip():
    s = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
    try:
        s.connect(("8.8.8.8", 80))
        ip = s.getsockname()[0]
    except Exception:
        ip = "127.0.0.1"
    finally:
        s.close()
    return ip

@app.route("/")
def index():
    return render_template_string(HTML)

@app.route("/qr")
def qr():
    ip = get_ip()
    url = f"http://{ip}:5000/view"
    img = qrcode.make(url)
    img_path = "qr.png"
    img.save(img_path)
    return send_file(img_path, mimetype="image/png")

@app.route("/view")
def view():
    return "<h3>Connected âœ” (View Only)</h3>"

if __name__ == "__main__":
    # hakikisha unarun kutoka folder ya project
    app.run(host="0.0.0.0", port=5000, debug=False)







